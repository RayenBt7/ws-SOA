package com.revision.service;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;

import com.revision.entities.Client;
import com.revision.entities.Commande;

public class CommandeServiceImpl implements CommandeService {

	EntityManagerFactory emf = Persistence.createEntityManagerFactory("revision");
	EntityManager em = emf.createEntityManager();
	ClientServiceImpl cls = new ClientServiceImpl();

	@Override
	public boolean addCommande(Commande cmd, Long idClient) {
		try {
			if (!em.getTransaction().isActive())
				em.getTransaction().begin();

			Client client = cls.getClientById(idClient);
			cmd.setClient(client);

			em.persist(cmd);
			em.getTransaction().commit();
			em.clear();
			return true;
		} catch (Exception e) {
			e.printStackTrace();
			if (em.getTransaction().isActive())
				em.getTransaction().rollback();
			return false;
		}
	}

	@Override
	public List<Commande> getCommandes(Long ClientId) {
		try {
			if (!em.getTransaction().isActive())
				em.getTransaction().begin();

			return em.createQuery(
			        "SELECT c FROM Commande c WHERE c.client.id = :idClient",
			        Commande.class
			    )
			    .setParameter("idClient", ClientId)
			    .getResultList();		
		} catch (Exception e) {
			e.printStackTrace();
			
			return null;
		}
	}

}
